<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="description" content="Javascript30 challenge 3 - CSS Variables">
  <title>CSS Variables</title>

  <!-- LINK STYLESHEETS -->
  <link rel="stylesheet" href="../../assets-shared/css/fonts.css">
  <link rel="stylesheet" href="../../assets-shared/css/buttons.css">
  <link rel="stylesheet" href="../../assets-shared/css/basics.css">
</head>

<body>
  <div style="display: flex;">

    <div>
      <img class="image-left" src="" alt="">
    </div>

    <div class="controller">
      <h1 class="text-left">Image <span class="hl">Editor</span></h1>
      <p class="text-left">
        Manipulating CSS Variables with JavaScript and AJAX. This is my personal solution to the <a href="https://javascript30.com/">Javascript30</a> challenge by <a href="https://wesbos.com/">WESBOS</a>.
      <p/>

      <p id="new-image-bttn" class="bttn bttn-round">NEW IMAGE</p>
    </div>

  </div>

  <!-- LOAD JAVASCRIPS AFTER PAGELOAD -->
  <script src="../../assets-shared/js/buttons.js"></script>
</body>
</html>

<!-- INLINE STYLE -->
<style>
  :root {
    --main-color: #7452ac;
  }

  h1, .controller > p {
    margin: 40px;
  }
  .image-left {
    height: 100vh;
    max-width: 70vw;
    transition: width 1s ease;
  }
  .toggled {
    height: 100vh;
    transition: width 1s ease;
  }
  .controller {
    height: 100vh;
    width: 400px;
  }

  /*.controls {
    border: 2px solid red;
    width: 600px;
    height: 150px;
    margin: 0 auto;
  }
  img#banner-img {
    border: 2px solid purple;
    width: 400px;
    height: 400px;
    display: block;
    margin: 40px auto;
    border-radius: 1%;
    filter: blur();
  }*/
  .hl {
    color: var(--main-color);
  }

</style>

<!-- INLINE SCRIPT -->
<script>
  // get DOM Elements
  const imgLeft = document.querySelector('.image-left');
  const newImgBttn = document.getElementById('new-image-bttn');
  console.log(newImgBttn);


  let downloadingImage = new Image();

  downloadingImage.onload = function(){
    let targetWidth = this.width * (window.innerHeight / this.height);
    targetWidth = Math.min(targetWidth, window.innerWidth * 0.7);
    imgLeft.width = targetWidth;
    imgLeft.src = this.src;
    imgLeft.classList.add("toggled");
  };

  newImgBttn.addEventListener("click", () => {
    console.log("hi");
    getRandomImgUrl();

  })
  //
  const getRandomImgUrl = () => {
    fetch(`https://picsum.photos/v2/list?limit=100&page=${Math.ceil(Math.random()*9)}`)
    .then((resp) => resp.json())
    .then((data) => {
      if (data) {
        downloadingImage.src = data[Math.ceil(Math.random()*100)-1].download_url;
        imgLeft.classList.remove("toggled");
      }
    });
  }

  // INITIALIZATION (SKRIPT START)
  getRandomImgUrl();
</script>
